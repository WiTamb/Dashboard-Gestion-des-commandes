<div class="fade-in">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h1>{{ editMode ? 'Modifier la Commande' : 'Nouvelle Commande' }}</h1>
    </div>

    <div class="glass-card p-4">
        <form #orderForm="ngForm" (ngSubmit)="onSaveOrder(orderForm)">
            <!-- Customer Name -->
            <div class="mb-4">
                <label for="customerName" class="form-label text-white">Nom du Client</label>
                <input type="text" class="form-control bg-dark text-white border-secondary" id="customerName"
                    name="customerName" [(ngModel)]="order.customerName" required placeholder="Entrez le nom du client">
            </div>

            <!-- Status (only in edit mode) -->
            <div class="mb-4" *ngIf="editMode">
                <label for="status" class="form-label text-white">Statut</label>
                <select class="form-select bg-dark text-white border-secondary" id="status" name="status"
                    [(ngModel)]="order.status">
                    <option *ngFor="let opt of statusOptions" [value]="opt">{{ opt }}</option>
                </select>
            </div>

            <!-- Add Item Section -->
            <div class="mb-4">
                <label class="form-label text-white">Ajouter un Article</label>
                <div class="row g-2">
                    <div class="col-md-6">
                        <select class="form-select bg-dark text-white border-secondary" [(ngModel)]="selectedArticleId"
                            name="selectedArticle">
                            <option value="">-- Sélectionner un article --</option>
                            <option *ngFor="let article of articles" [value]="article._id">
                                {{ article.name }} - {{ article.price | currency:'TND':'symbol':'1.0-0' }}
                            </option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="number" class="form-control bg-dark text-white border-secondary"
                            [(ngModel)]="selectedQuantity" name="selectedQty" min="1" placeholder="Qté">
                    </div>
                    <div class="col-md-3">
                        <button type="button" class="btn btn-outline-success w-100" (click)="addItem()">
                            <i class="fas fa-plus me-1"></i> Ajouter
                        </button>
                    </div>
                </div>
            </div>

            <!-- Items List -->
            <div class="mb-4">
                <label class="form-label text-white">Articles de la Commande</label>
                <div class="table-responsive">
                    <table class="table table-dark table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Article</th>
                                <th>Prix Unitaire</th>
                                <th>Quantité</th>
                                <th>Sous-total</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of order.items; let i = index">
                                <td>{{ item.name }}</td>
                                <td>{{ item.price | currency:'TND':'symbol':'1.0-0' }}</td>
                                <td>{{ item.quantity }}</td>
                                <td class="fw-bold">{{ item.price * item.quantity | currency:'TND':'symbol':'1.0-0' }}
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-outline-danger" (click)="removeItem(i)">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr *ngIf="order.items.length === 0">
                                <td colspan="5" class="text-center text-muted py-3">Aucun article ajouté</td>
                            </tr>
                        </tbody>
                        <tfoot *ngIf="order.items.length > 0">
                            <tr>
                                <td colspan="3" class="text-end fw-bold">Total:</td>
                                <td class="fw-bold text-success">{{ order.total | currency:'TND':'symbol':'1.0-0' }}
                                </td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- Buttons -->
            <div class="d-flex gap-3">
                <button type="submit" class="btn btn-premium" [disabled]="isLoading">
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
                    {{ editMode ? 'Mettre à Jour' : 'Créer la Commande' }}
                </button>
                <button type="button" class="btn btn-outline-secondary" routerLink="/orders">Annuler</button>
            </div>
        </form>
    </div>
</div>